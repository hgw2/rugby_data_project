---
title: "The Team That Kicks More Wins More"
author: "Harry Williams"
date: "08/01/2021"
output: 
  html_document: 
    theme: journal
    toc: yes
    toc_float: yes
  
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Introduction

During the Autumn Nations Cup in November 2020, Eddie Jones was questioned on his teams decision to kick the ball more in matches. His answer that he gave in a press was that “The teams that kick the most win games”.^[https://www.macclesfieldrufc.co.uk/2020/12/what-should-our-game-look-like-in-2021/] Even as early as 2010, the then Wales kicking coach, Neil Jenkins, can be quoted saying the same thing.^[https://www.theguardian.com/sport/2010/feb/01/wales-lee-byrne-six-nations-ban] This analysis will examine those claims and see if there is any evidence to suggest that teams that kick the most ar more likely to win. It will also explore any possible explanations for why this may be the case.  

```{r Load Packages, message=FALSE, warning=FALSE, include=FALSE}
library(corrr)
library(janitor)
library(tidyverse)
library(infer)
library(janitor)
library(lubridate)
library(tsibble)
library(rvest)
library(ggfortify)
library(GGally)
library(modelr)
library(knitr)
library(kableExtra)
library(extrafont)
```


## Data
```{r message=FALSE, warning=FALSE, include=FALSE}
# source("1_get_data/")

length(list.files("3_raw_data/team_data/"))


international <- c(
  "australia", "new_zealand", "england", "south_africa", "ireland", "italy",
  "japan", "scotland", "wales", "france", "argentina", "georgia",
  "fiji", "romania", "usa", "tonga", "russia", "namibia",
  "samoa", "uruguay", "canada"
)



```

```{r Load Data, message=FALSE, warning=FALSE, include=FALSE}
team_data <- read_csv("5_clean_data/team_data.csv",
  col_types =
    cols(
      season = "c"
    )
) %>% 
  mutate(year = year(date), .after = season) %>% 
  select(-season) %>% 
  mutate(type_of_team = if_else(team %in% international, "international", "club"), .after = team) %>% 
  mutate(hemisphere = case_when(
    competition %in% c("autumn_nations_cup", "european_champions_cup", "premiership", "premiership_cup", "pro_14", "six_nations") ~ "northern",
    competition%in% c("internationals", "rugby_world_cup") ~ "mixed",
    TRUE ~ "southern"), .after = competition
  )
  
```

```{r Get number of wins and kicks, message=FALSE, warning=FALSE, include=FALSE}


# Create Data showing the teams result from the match and whether they kicked more than the opposition 
matches <- team_data %>%
  filter(stat == "points_scored" | stat == "kicks_from_hand") %>%
  pivot_wider(names_from = stat, values_from = values) %>%
  group_by(date, match) %>%
 
  #Calculate the totals for each match
   mutate(
    total_scored = sum(points_scored),
    total_kick = sum(kicks_from_hand)
  ) %>%
  ungroup() %>%
  
  # Subtract own point and kicks from total to get oppositions in the row
  mutate(
    opposition_points = total_scored - points_scored,
    opposition_kicks = total_kick - kicks_from_hand
  ) %>%
  select(-total_scored, -total_kick) %>%
  mutate(kick_diff = kicks_from_hand - opposition_kicks) %>%
 
   # Compare own stats with oppositions 
  mutate(
    result = case_when(
      points_scored > opposition_points ~ "won",
      points_scored < opposition_points ~ "lost",
      points_scored == opposition_points ~ "draw"
    ),
    kicks =ifelse(kicks_from_hand > opposition_kicks, "more", "not_more")
  ) 

```



### Competitions

Data has been sourced from the Rugby Pass website.^[https://www.rugbypass.com/] At time of writing this includes a total 420 professional Rugby matches from around the world over the last 3 years. This includes both international and club rugby games from the following competitions:

```{r Create Competetion Table, echo=FALSE, message=FALSE, warning=FALSE}
team_data %>% 
  select(competition, type_of_team, hemisphere) %>% 
  distinct(competition, .keep_all = TRUE) %>% 
  arrange(competition) %>% 
  mutate_all( ~ str_replace_all(., "_", " ")) %>% 
    mutate_all( ~ str_to_title(.)) %>% 
 rename_all( ~ str_replace_all(., "_", " ")) %>% 
    rename_all( ~ str_to_title(.))   %>% 
 kbl() %>%
  kable_classic(full_width = T, html_font = "Book Antiqua" )
```

### Variables

The Variables collected from each match are as follows:

```{r Creat stats table, echo=FALSE, message=FALSE, warning=FALSE}

row_1 <- team_data %>% 
  distinct(stat) %>%  
  arrange(stat)%>% 
  mutate_all( ~ str_replace_all(., "_", " ")) %>% 
    mutate_all( ~ str_to_title(.)) %>% 
 rename_all( ~ str_replace_all(., "_", " ")) %>% 
    rename_all( ~ str_to_title(.))   %>% 
  slice(1:8)

row_2 <- team_data %>% 
  distinct(stat) %>% 
  arrange(stat)%>% 
  mutate_all( ~ str_replace_all(., "_", " ")) %>% 
    mutate_all( ~ str_to_title(.)) %>% 
 rename_all( ~ str_replace_all(., "_", " ")) %>% 
    rename_all( ~ str_to_title(.))   %>% 
  slice(9:16)


row_3 <- team_data %>% 
  distinct(stat) %>% 
  arrange(stat)%>% 
  mutate_all( ~ str_replace_all(., "_", " ")) %>% 
    mutate_all( ~ str_to_title(.)) %>% 
 rename_all( ~ str_replace_all(., "_", " ")) %>% 
    rename_all( ~ str_to_title(.))   %>% 
  slice(17:24)

row_4 <- team_data %>% 
  distinct(stat) %>% 
  arrange(stat)%>% 
  mutate_all( ~ str_replace_all(., "_", " ")) %>% 
    mutate_all( ~ str_to_title(.)) %>% 
 rename_all( ~ str_replace_all(., "_", " ")) %>% 
    rename_all( ~ str_to_title(.))   %>% 
  slice(25:32)

table <- bind_cols(row_1, row_2, row_3, row_4)

names(table) <- NULL

table %>% 
kbl() %>%
 kable_classic(full_width = T, html_font = "Book Antiqua")
```




### Key Variables

Since this analysis focuses on  kicking the key variable we are looking at in the data is `Kicks From Hand`. This is the total number of kicks in play, this does not include penalty kicks. This analysis will also look at `Win Rate`, the percentage number of wins for a team and `Kick Rate`, the percentage number of times a team has kicked more than their opposition. Both have been calculated in the following ways:

<br> 

$$Win\:Rate = \frac{Number\:of\:Matches\:Won}{Total\:Matches\:Played}$$
<br>

$$Kick\:Rate = \frac{Number\:of\:Times\:Kicked\: More\: Than\: Opposition}{Total\:Matches\:Played}$$

<br>

### Data Limitions 

#### Rugby Pass Data

Although there are a total of 425 professional rugby matches, the majority of the matches are from 2020. For competitions currently being played e.g. The Rugby Premiership and Pro 14, only matches from the current season are included in the dataset as this is the only data that can be collected from the website. International matches are almost complete, however, there are a few important matches from the World Cup (Semi-finals onwards) whichare also missing.

<br>

```{r echo=FALSE, message=FALSE, warning=FALSE}
team_data %>% 
  distinct(match, date, .keep_all = T) %>% 
  group_by(year) %>% 
  summarise(Count = n()) %>% 
  rename(Year = year) %>% 
 kbl() %>%
  kable_classic(full_width = F, html_font = "Book Antiqua")
```
<br>
#### Variable Limitions

The variables collected offer an overview of the matches. Unfortunately, it is difficult to distinguish from different circumstances. This is problematic when looking at kicking data. Tactically, a kick from a team's own 22 is very different from a kick from the halfway line or inside the oppositions half. This also applied to penalties as it is difficult to determine how each penalty was conceded e.g. from the breakdown or scrum.  These statistics would offer a much more detailed analysis than a general overview.



# Analysis

## Teams that kicks more than the opposition

### Percentage Number of Match Wins

Using the data, the percentage number of wins for teams that kick more than their opponents are as follows:



```{r echo=FALSE, message=FALSE, warning=FALSE}
matches %>% 
  dplyr::filter(kicks == "more") %>% 
  mutate(kicks = str_to_title(kicks)) %>%
  mutate(across(where(is.character), ~ str_to_title(.))) %>% 
  ggplot() +
  aes(x = result, y = ..prop.., group = kicks, fill = type_of_team) +
  geom_bar(stat = "count", show.legend = FALSE) +
  facet_wrap(~type_of_team) + 
 scale_y_continuous(labels = scales::percent_format(accuracy = 1)) +
  labs(title = "Percentage Number of Wins for Teams That Kick More Their Oppositon",
       x = "Result",
       y = "Percentage") + 
  theme_minimal() +
  theme(text = element_text(family = "Book Antiqua"))

```



\n When looking at the winners of the matches, in both club and international matches the team that kicked more than their opponents won a larger proportion of their matches. This suggesting that if a team kicks more than their opposition then they are more likely to win the match. From this dataset, a team that kicks more than their opposition wins around 67% of their matches. 


### Hypothesis Test 

Since this dataset is a sample a hypothesis test needs to be carried out to confirm if 67% reflects the wider game. The method for the test can be found in the dropdown.

<br>
<details class='maths'>
<summary>**Hypothesis Test**</summary>

Using this data lets put that to the test if the claim is statistically significant. If kicking did not have an impact on matches you would expect the proportion of match wins to be around 50% 

H~o~: π matches won = 0.5

H~A~: π matches won > 0.5

α = 0.05

```{r include=FALSE}
test_matches <- matches %>% 
  mutate(won = result == "won") %>% 
  filter(kicks == "more")


```


```{r stats_test}

tset_matches_sample <- test_matches 
  
null_distribution <- tset_matches_sample %>%
  specify(response = won, success = "TRUE") %>% 
  hypothesize(null = "point", p = 0.5) %>%
  generate(reps = 10000, type = "simulate") %>%
  calculate(stat = "prop")

observed_stat <- tset_matches_sample %>%
  specify(response = won, success = "TRUE") %>% 
  calculate(stat = "prop")


```

```{r message=FALSE, warning=FALSE}
  p_value <- null_distribution %>%
  get_p_value(obs_stat = observed_stat, direction = "both")


null_distribution %>%
  visualise(bins = 30) + 
  shade_p_value(obs_stat = observed_stat, direction = "right") +
  labs(title = paste("p-value =", p_value ))+
  theme(text = element_text(family = "Book Antiqua"))


     
```
\n 

The p-value is less than α so we reject H~0~ in favour of H~A~. There is enough evidence from our data to suggest that the proportion of wins is statistically significantly greater than the null value. This means that statistically, teams that kick more than their opponents win more games.

</details>
<br>

<hr>

### Results of the test

The hypothesis test has shown that there is enough evidence from this dataset to say that teams that kick more than their opponent will win more of their games.
A further computation can be carried out to give a percentage range within a 95% confidence interval.

```{r message=FALSE, warning=FALSE, include=FALSE}
bootstrap_resample <- test_matches %>%
  specify(response = won, success = "TRUE") %>% 
  generate(reps = 10000, type = "bootstrap") %>%
  calculate(stat = "prop")
```

### Estimated Percentage Wins

<br>
```{r echo=FALSE}
kick_ci_95 <- bootstrap_resample %>%
  get_confidence_interval(level = 0.95, type = "percentile") %>% 
  mutate_all(~ paste(round(. * 100, 2), "%", sep = "")) 

names(kick_ci_95) <- c("Lower Confidence Interval", "Upper Confidence Interval")

kick_ci_95 %>% 
  kbl() %>%
  kable_classic(full_width = F, html_font = "Book Antiqua")
```


<br>

From this dataset, we can estimate that teams that kick more than their opponents win between 64% - 73% of their total matches with a 95% confidence interval. Teams that kick more do win more of their matches. Kicking more does not result in winning games but these estimates do suggest that it does play a role. 

## Win Rate vs Kick Rate

To try and explore the role kicking plays, we will look at the breakdown of the teams. Firstly looking at Win Rate vs Kick Rate
\n


```{r message=FALSE, warning=FALSE, include=FALSE}

# Get Win Rate
team_results <- matches %>%
  group_by(team, result) %>%
  summarise(count = n()) %>%
  ungroup() %>%
  pivot_wider(names_from = result, values_from = count) %>%
  mutate_if(is.numeric, ~ coalesce(.x, 0)) %>%
  rowwise() %>%
  mutate(
    no_matches = sum(draw, lost, won),
    win_rate = won / no_matches
  )
  
# Get Kick Rate
team_kicks <- matches %>%
  group_by(team, kicks) %>%
  summarise(count = n()) %>%
  ungroup() %>%
  pivot_wider(names_from = kicks, values_from = count) %>%
  mutate_if(is.numeric, ~ coalesce(.x, 0)) %>%
  rowwise() %>%
  mutate(
    no_matches = sum(more, not_more),
    kick_rate = more / no_matches
  ) %>%
  arrange(desc(kick_rate))

# Create Table 
team_rates <- team_results %>%
  left_join(team_kicks) %>%
  arrange(desc(kick_rate, win_rate))


```

```{r echo=FALSE, message=FALSE, warning=FALSE}
team_rates %>%
  ggplot() +
  aes(x = kick_rate, y = win_rate) +
  geom_point() +
  geom_smooth(method = lm, se = FALSE) +
  labs(title = paste("Pearson Corrleation =", round(cor(team_rates$kick_rate, team_rates$win_rate), 4)),
       x = "Kick Rate",
       y = "Win Rate") +
   scale_y_continuous(labels = scales::percent_format(accuracy = 1)) +
  scale_x_continuous(labels = scales::percent_format(accuracy = 1)) +
  theme_minimal() + 
  theme(text = element_text(family = "Book Antiqua"))


```

\n

If we plot the two variables together there is a weak correlation of 0.257. There is quite a lot of spread within the data but there is still a general trend; teams that have a higher kick rate also have a higher win rate. As there is a weak correlation,  there are other variables that also lead to a higher Win Rate, not just Kick Rate.

## Win Rate vs Average Number of Kicks Per Game 



\n 
### Top 10 teams by Avgerage Number Of Kicks Per Game
```{r get avg no of kicks, message=FALSE, warning=FALSE, include=FALSE}
avg_kicks <- matches %>%
  group_by(team) %>%
  summarise(avg._no._kicks_per_game = mean(kicks_from_hand))

team_kicks <- team_results %>%
  left_join(avg_kicks)

```

\n 
```{r echo=FALSE, message=FALSE, warning=FALSE}
team_kicks %>%
  filter(no_matches > 5) %>%
  ungroup() %>%
  mutate(rank = rank(-avg._no._kicks_per_game, ties.method = "first"), .before = team) %>%
  slice_max(avg._no._kicks_per_game, n = 10, with_ties = F) %>%
  select(-no_matches) %>% 
  relocate(avg._no._kicks_per_game, .after = team) %>% 
  mutate(team = str_replace_all(team,"_", " ")) %>% 
  mutate(team = str_to_title(team))%>% 
  mutate(win_rate = paste(round(win_rate * 100, 2), "%", sep = ""))  %>% 
  mutate(avg._no._kicks_per_game = round(avg._no._kicks_per_game, 2)) %>% 
 rename_all( ~ str_replace_all(., "_", " ")) %>% 
    rename_all( ~ str_to_title(.))   %>% 
 kbl() %>%
  kable_classic(full_width = T, html_font =  "Book Antiqua")
```
Looking at the top 10 teams, there is no pattern between the teams with the higher average number of kicks and win rate.  Interestingly of the top 10, 4 of the teams are international teams showing how kicking is more prevalent in the international game. If we drill down further we can see that this is the case for all matches:


<br>

```{r echo=FALSE, message=FALSE, warning=FALSE}
matches %>% 
  group_by(type_of_team) %>%  
  summarise(avg._no._kicks_per_games = round(mean(kicks_from_hand), 2)) %>% 
  mutate(type_of_team = str_to_title(type_of_team)) %>% 
rename_all( ~ str_replace_all(., "_", " ")) %>% 
    rename_all( ~ str_to_title(.))   %>% 
 kbl() %>%
  kable_classic(full_width = F, html_font = "Book Antiqua")
```


<br>

### Win Rate vs Average Number of Kicks Per Game Plot

\n 

```{r echo=FALSE, message=FALSE, warning=FALSE}
team_kicks %>%
  ggplot() +
  aes(x = avg._no._kicks_per_game, y = win_rate) +
  geom_point() +
 geom_smooth(method = lm, se = FALSE) +
  labs(title = paste("Pearson Corrleation =", round(cor(team_kicks$avg._no._kicks_per_game, team_kicks$win_rate), 4)),
       x = "Avg. No. Kicks Per Game",
       y = "Win Rate") +
   scale_y_continuous(labels = scales::percent_format(accuracy = 1)) +
  theme_minimal() +
  theme(text = element_text(family = "Book Antiqua"))


```





\n 

If we then look at the correlation we can see that there is even less of a correlation between the average number of kicks per game and win rate. This adds a level of complexity to the issue. We have seen that kicking more than the opposition can result in a higher win rate, however from this, simply having a high number of kicks per game does not. Further exploration is needed to try to explain this.

## Further Exploration 

\n

As the data is more complete when looking at international matches, this exploration will focus only on the international game. As we have seen teams that if a team kicks more than their opposition there is a higher chance of winning. Teams that do this more regularly also have a higher win rate. However, having a higher number of kicks does not result in a better win rate. More variables can explain this. 


```{r message=FALSE, warning=FALSE, include=FALSE}
data <- team_data %>%
  pivot_wider(names_from = stat, values_from = values) %>% 
  rowwise %>% 
  mutate(penalty_goal_attempts = penalty_goal_successful + penalty_missed)
```

### Correlation with `Kicks From Hand`

Below is a graph showing which other variables correlate with `Kicks From Hand`:


```{r echo=FALSE, message=FALSE, warning=FALSE}
data %>% 
      filter(type_of_team == "international") %>% 
  select(-competition:-team, - type_of_team) %>% 
  correlate() %>% 
  focus(kicks_from_hand) %>% 
   mutate(across(where(is.character), ~ str_replace_all(., "_", " "))) %>% 
   mutate(across(where(is.character), ~ str_to_title(.))) %>% 
  ggplot()+
  aes(x = reorder(term, kicks_from_hand), y = kicks_from_hand, fill = kicks_from_hand > 0) +
  geom_col(show.legend = FALSE) +
  coord_flip() +
  labs(title = "Other Variables vs. Kicks From Hand",
       x = "Variable",
       y = "Correlation with Kicks From Hand") + 
  theme_minimal() +
  theme(text = element_text(family = "Book Antiqua"))

```

<br> 

Anything over 0.2 shows a weak correlation. From this, there appears to be a weak correlation between the Number of Kicks from hand and the number of Penalty Goals. This could perhaps explain why teams that kick more than their opponents have a higher chance of winning as the data suggests they are more likely to have more opportunities to kick at goal.  However, further exploration is still needed to try to explain this correlation. 

Unfortunately the data there is too much spread in the data and variables are not ideal to produce a predictive model but they can offer some insight by producing an explanatory model

### Explanatory Model 

<details class='maths'>
<summary>**Model Construction**</summary>

```{r message=FALSE, warning=FALSE, include=FALSE}

major <- data %>% 
 filter(competition %in% c("six_nations", "the_rugby_championship")) %>% 
  distinct(team) %>% 
  pull()

model_data <- data %>%
      filter(type_of_team == "international") %>% 
  mutate(team = if_else(!team %in% major, "minor_nation", team)) %>% 
  select(-competition, -date,  -lineout_throw_won_clean ,- type_of_team, - match, -penalty_goal_attempts, -try_assist, -red_card, -yellow_card, - hemisphere) %>% 
  mutate(across(where(is_character), ~ as_factor(.))) %>% 
  mutate(year= as.factor(year))  


```



Penalty Goal Successful and team both look like good options


```{r}
mod1a <- lm(kicks_from_hand ~ team, data = model_data)
```


```{r}
autoplot(mod1a) +
  theme(text = element_text(family = "Book Antiqua"))

summary(mod1a)
```

As with the top 10 teams with the highest average kicks per game, England, France, South Africa, Wales contribute towards kicking more in matches

```{r}
mod1b <- lm(kicks_from_hand ~ penalty_goal_successful, data = model_data)

autoplot(mod1b) +
  theme(text = element_text(family = "Book Antiqua"))

summary(mod1b)
```

mod1a has the highest r^2 so that will be used.





```{r}
mod2a <- lm(kicks_from_hand ~ team + penalty_goal_successful, data = model_data)

autoplot(mod2a)+
  theme(text = element_text(family = "Book Antiqua"))

summary(mod2a)
```




```{r}
mod2b <- lm(kicks_from_hand ~ team + year, data = model_data)

autoplot(mod2b)+
  theme(text = element_text(family = "Book Antiqua"))

summary(mod2b)
```

mod2a has the highest r^2 so is the best option 



```{r}
mod3a <- lm(kicks_from_hand ~ team + penalty_goal_successful + lineout_won_own_throw, data = model_data)

autoplot(mod3a)+
  theme(text = element_text(family = "Book Antiqua"))

summary(mod3a)
```

```{r}
mod3b <- lm(kicks_from_hand~ team + penalty_goal_successful+total_turnovers_gained , data = model_data)

autoplot(mod3b)+
  theme(text = element_text(family = "Book Antiqua"))

summary(mod3b)
```

mod3a  has the highest r^2 is the better model going forward



```{r}
mod4a <- lm(kicks_from_hand ~ team + penalty_goal_successful + lineout_won_own_throw  + line_break, data = model_data)

summary(mod4a)
```

```{r}
mod4b <- lm(kicks_from_hand ~ team + penalty_goal_successful + lineout_won_own_throw  + total_turnovers_gained, data = model_data)

summary(mod4b)
```




```{r}
mod4c <- lm(kicks_from_hand ~ team + penalty_goal_successful + lineout_won_own_throw + lineout_won_steal, data = model_data)

autoplot(mod4c)+
  theme(text = element_text(family = "Book Antiqua"))

summary(mod4c)


```




team:penalty_goal_successful

```{r}
mod5a <- lm(kicks_from_hand ~ team + penalty_goal_successful + lineout_won_own_throw + total_turnovers_gained + team:penalty_goal_successful, data = model_data)

summary(mod5a)
```


```{r}
anova(mod4b, mod5a)
```

mod4b is the best model as team:penalty_goal_successful is not statistically significant

```{r}
best_model <- mod4b
```


</details>
<br>

<hr>

```{r echo=FALSE, message=FALSE, warning=FALSE}
summary(best_model)
```

<br> 


From the summary of the best fitting model, we can gather some useful insights. Unfortunately because of the spread of the data, the model only fits 33% of the data. Although the model is not perfect it does highlight a few interesting points. The model highlights which teams are more likely to play a kicking game (the higher estimate for the team). There is also a statistically significant relationship with the number of penalty goals, and both own lineouts won and stolen. Unfortunately because of this dataset, it is very difficult to draw any conclusions. However, because there is a statistically significant relationship with those points it suggests that they are important in explaining why teams that kick more win more. 

One possible explanation could be that when a team kicks more than their opposition the game would be played more in the opposition's territory so therefore any penalties that are awarded would be within kicking distance. Although without looking at the type of kicks or why penalties are conceded it is difficult to come to any formal conclusions from this dataset.




# Key Takeaways
* Teams that kick more than their opposition are between 63% - 73% more likely to win the match
* Teams that constantly kick more than their opponents are also more likely to have a higher win rate 
* There is no link to having an average behind having a higher number of kicks per game
* The most important factor in determining the number of kicks is the team. The model highlights which team play more likely to play a kicking game.
* The model also offers some possible explanations for why teams that kick more than their opposition because teams that have a higher number of kicks in a game may also have more opportunities to kick at goal and more likely to have successful lineouts.



# Future Research

This dataset has led to come useful insights, however, it does not go the full way in fulling understanding the kicking. With a broader dataset and an analysis of every single kick in the game, a better understanding can be made. 